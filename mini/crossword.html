<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Hangul Crossword Input</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo",
                   "Noto Sans KR", sans-serif;
      padding: 40px;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(5, 48px);
      gap: 6px;
    }

    .cell {
      width: 48px;
      height: 48px;
      text-align: center;
      font-size: 22px;
      border: 1px solid #444;
      box-sizing: border-box;
    }

    .cell:focus {
      outline: 2px solid #3b82f6;
    }
  </style>
</head>
<body>

<h1>í•œê¸€ í¬ë¡œìŠ¤ì›Œë“œ ì…ë ¥ í…ŒìŠ¤íŠ¸</h1>

<div id="grid">
  <input class="cell" />
  <input class="cell" />
  <input class="cell" />
  <input class="cell" />
  <input class="cell" />
</div>

<script>
  /* ===============================
     ê¸°ë³¸ ì„¤ì •
     =============================== */

  const cells = Array.from(document.querySelectorAll(".cell"));
  let isComposing = false;

  cells.forEach(cell => {
    cell.setAttribute("maxlength", "2"); // IME ì¡°í•© ëŒ€ë¹„
    cell.setAttribute("autocomplete", "off");
    cell.setAttribute("inputmode", "text");
  });

  /* ===============================
     ìœ í‹¸ í•¨ìˆ˜
     =============================== */

  function getNextCell(index) {
    return cells[index + 1] ?? null;
  }

  function getPrevCell(index) {
    return cells[index - 1] ?? null;
  }

  function focusCell(cell) {
    if (cell) cell.focus();
  }

  function distributeText(startIndex, text) {
    let i = startIndex;
    for (const ch of text) {
      if (i >= cells.length) break;
      cells[i].value = ch;
      i++;
    }
    focusCell(cells[Math.min(i, cells.length - 1)]);
  }

  /* ===============================
     ì´ë²¤íŠ¸ ë°”ì¸ë”©
     =============================== */

  cells.forEach((cell, index) => {

    /* --- IME ì‹œì‘ --- */
    cell.addEventListener("compositionstart", () => {
      isComposing = true;
    });

    /* --- IME ì¢…ë£Œ (í•µì‹¬ ë¡œì§) --- */
    cell.addEventListener("compositionend", (e) => {
      isComposing = false;

      const text = e.target.value;

      // ì •ìƒì ì¸ í•œ ìŒì ˆ
      if (text.length === 1) {
        focusCell(getNextCell(index));
        return;
      }

      // ğŸ‘ˆ í•µì‹¬ ì¼€ì´ìŠ¤: "ê°€ë‚˜"
      if (text.length === 2) {
        e.target.value = text[0];

        const next = getNextCell(index);
        if (next) {
          next.value = text[1];
          focusCell(next);
        }
        return;
      }

      // ë¶™ì—¬ë„£ê¸° / ìë™ì™„ì„±
      if (text.length > 2) {
        e.target.value = "";
        distributeText(index, text);
      }
    });

    /* --- ì¼ë°˜ input (ì˜ë¬¸/ëª¨ë°”ì¼ ëŒ€ë¹„) --- */
    cell.addEventListener("input", (e) => {
      if (isComposing) return;

      const text = e.target.value;

      if (text.length === 1) {
        focusCell(getNextCell(index));
        return;
      }

      if (text.length > 1) {
        e.target.value = "";
        distributeText(index, text);
      }
    });

    /* --- í‚¤ë³´ë“œ ì´ë™ & ì‚­ì œ --- */
    cell.addEventListener("keydown", (e) => {
      if (isComposing) return;

      if (e.key === "Backspace") {
        if (cell.value === "") {
          const prev = getPrevCell(index);
          if (prev) {
            prev.value = "";
            focusCell(prev);
          }
        } else {
          cell.value = "";
        }
        e.preventDefault();
      }

      if (e.key === "ArrowRight") {
        focusCell(getNextCell(index));
        e.preventDefault();
      }

      if (e.key === "ArrowLeft") {
        focusCell(getPrevCell(index));
        e.preventDefault();
      }
    });
  });
</script>

</body>
</html>
