<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Hangul Crossword – Stable Version</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif;
      padding: 40px;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(5, 48px);
      gap: 6px;
    }

    .cell {
      width: 48px;
      height: 48px;
      text-align: center;
      font-size: 22px;
      border: 1px solid #444;
      box-sizing: border-box;
    }

    .cell:focus {
      outline: 2px solid #2563eb;
    }
  </style>
</head>
<body>

<h1>한글 크로스워드 입력 (NYT-style)</h1>
<p>빠르게 <strong>가나다라마</strong>를 쳐보세요.</p>

<div id="grid">
  <input class="cell" maxlength="1" />
  <input class="cell" maxlength="1" />
  <input class="cell" maxlength="1" />
  <input class="cell" maxlength="1" />
  <input class="cell" maxlength="1" />
</div>

<script>
  const cells = Array.from(document.querySelectorAll(".cell"));
  let isComposing = false;

  /* ---------- 유틸 ---------- */

  function focusCell(cell) {
    if (cell) cell.focus();
  }

  function getNextCell(index) {
    return cells[index + 1] ?? null;
  }

  function distributeText(startIndex, text) {
    let i = startIndex;
    for (const ch of text) {
      if (i >= cells.length) break;
      cells[i].value = ch;
      i++;
    }
    focusCell(cells[Math.min(i, cells.length - 1)]);
  }

  /* ---------- 이벤트 ---------- */

  cells.forEach((cell, index) => {
    cell.setAttribute("autocomplete", "off");
    cell.setAttribute("inputmode", "text");

    cell.addEventListener("compositionstart", () => {
      isComposing = true;
    });

    cell.addEventListener("compositionend", (e) => {
      isComposing = false;

      const text = e.target.value;

      // 정상: 한 음절
      if (text.length === 1) {
        focusCell(getNextCell(index));
        return;
      }

      // IME가 "가나"처럼 넘겨준 경우
      if (text.length > 1) {
        e.target.value = "";
        distributeText(index, text);
      }
    });

    cell.addEventListener("input", (e) => {
      if (isComposing) return;

      const text = e.target.value;

      if (text.length === 1) {
        focusCell(getNextCell(index));
        return;
      }

      if (text.length > 1) {
        e.target.value = "";
        distributeText(index, text);
      }
    });

    cell.addEventListener("keydown", (e) => {
      if (isComposing) return;

      if (e.key === "Backspace") {
        if (cell.value === "") {
          const prev = cells[index - 1];
          if (prev) {
            prev.value = "";
            focusCell(prev);
          }
        } else {
          cell.value = "";
        }
        e.preventDefault();
      }

      if (e.key === "ArrowRight") {
        focusCell(getNextCell(index));
        e.preventDefault();
      }

      if (e.key === "ArrowLeft") {
        focusCell(cells[index - 1]);
        e.preventDefault();
      }
    });
  });
</script>

</body>
</html>
